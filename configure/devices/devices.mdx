---
title: Configuration
---

In this section, you will learn how to create and configure your own devices file, and how to add more devices to it. This file is essential for integrating the PPL controller with the devices inside your microgrid application. The devices file can be found in the `/etc` folder of the `ppl-base` repository and is listed as `devices.json`.

The devices file is crucial for the operation of the PPL controller, as it contains the configuration details for all devices within your microgrid application. This JSON-formatted file is stored directly on the PPL controller. Upon startup, the controller reads this file and establishes connections with the listed devices.

### Add a New Device

When adding a new device, a critical part is specifying the communication protocol or the type for each device. This defines how the controller communicates with each device. The supported communication protocols and types include:

- **Modbus TCP/IP**
- **MQTT**
- **Digital I/O (Inputs/Outputs)**
- **Analog I/O (Inputs/Outputs)**

Each device entry in the file must specify the appropriate protocol from the list above. In addition to the protocol, a device entry in the devices file also contains other required and optional parameters. The required and optional parameters for each communication protocol are explained in more detail below.

### **Communication Protocol: Modbus TCP/IP**

To add a device using the Modbus TCP/IP communication protocol, the following parameters are required.

### **Required Parameters**

- **id:** A unique identifier for the device. (Type: String, e.g., “battery1”)
- **protocol:** The communication protocol between the controller and the device. For this type of device, it will always be "Modbus TCP/IP". (Type: String, e.g., "Modbus TCP/IP")
- **ipAddress:** The static IP address set for the device. (Type: String, e.g., "172.200.1.130")
- **port:** The port number used for communication. Please consult the device's manual to determine the port on which it communicates. (Type: Int, e.g., 502)
- **slaveId:** The slave ID of the device. Please consult the device's manual to determine the specific slave ID. (Type: Int, e.g., 1)
- **controlMap:** The path to the device’s control map on the controller. This should always be in the “opt/ppl/etc” directory. (Type: String, e.g., "/opt/ppl/etc/lgjh4_control.json")
- **addressMap:** The path to the device’s address map on the controller. This should always be in the “opt/ppl/etc” directory. (Type: String, e.g., "/opt/ppl/etc/lgjh4_address_map.json")
- **disabled:** Indicates whether the device is enabled or disabled. A value of true means the device is disabled, while false means the device is enabled. (Type: Bool)

The snippet below demonstrates a device with **id** "battery1" and **protocol** "Modbus TCP/IP", including all required parameters:

```json
{
  "id": "battery1",
  "protocol": "Modbus TCP/IP",
  "ipAddress": "172.200.1.130",
  "port": 502,
  "slaveId": 1,
  "controlMap": "/opt/ppl/etc/lgjh4_control.json",
  "addressMap": "/opt/ppl/etc/lgjh4_address_map.json",
  "disabled": false
}
```

---

The parameters listed below are optional and are not required for a device with the Modbus TCP/IP protocol to work properly. However, sometimes it is desirable to add these optional parameters for device monitoring or because they are required by the manufacturer.

### **Optional Parameters**

- **critical:** Marks this device as critical or not. If a device is marked as critical (value true), any fault occurring on this device will send out an alert or notification over Telegram. (Type: Bool)
- **communicationInterval:** Indicates the delay between consecutive Modbus operations, read or write. Between each Modbus command, the controller will wait this amount of time. The value is expressed in seconds. (Type: Int or Float)

The snippet below demonstrates a device with **id** “converter1” and **protocol** “Modbus TCP/IP”, including all the required parameters along with the optional parameters.

```json
{
  "id": "converter1",
  "protocol": "Modbus TCP/IP",
  "ipAddress": "172.200.1.131",
  "port": 502,
  "slaveId": 240,
  "controlMap": "/opt/ppl/etc/30C3_control.json",
  "addressMap": "/opt/ppl/etc/30C3_address_map.json",
  "disabled": false,
  "critical": true,
  "communicationInterval": 0.2
}
```

<aside>
⚠️ When configuring a device with Modbus TCP/IP communication, ensure all required parameters are correctly specified to prevent configuration errors. Optional parameters can offer additional functionality and control but are not essential for basic operation. Always verify that the paths provided for **addressMap** and **controlMap** are accurate and that the files exist in the specified locations.

</aside>

### Communication Protocol: MQTT

Coming soon…

### Device Type: Digital Input/Output

To add a digital input or a digital output device, such as pushbuttons or a LED status indicator, the following parameters are required.

**Required Parameters:**

- **id:** A unique identifier for the device. (Type: String, e.g., “pushbuttons”)
- **type:** Indicates the type of device. For this type of device, it is always "digitalInputOutput". (Type: String, e.g., "digitalInputOutput")
- **addressMap:** The path to the device’s address map on the controller. This should always be in the “opt/ppl/etc” directory. (Type: String, e.g., "/opt/ppl/etc/pushbuttons_address_map.json")
- **disabled:** Indicates whether the device is enabled or disabled. A value of true means the device is disabled, while false means the device is enabled. (Type: Bool)

The following parameters can be added to digital input or output devices; however, they are optional and not required. These parameters provide additional functionality to the device.

**Optional Parameters:**

- **retainInputs:** This parameter indicates if the inputs should be retained or not. If true, when input changes state, it will keep the value for 10 seconds. (Type: Bool)
    
    <aside>
    ❗ Note that this parameter is relevant only for digital inputs, not for outputs.
    
    </aside>
    
- **controlMap:** The path to the device’s control map on the controller. This should always be in the “opt/ppl/etc” directory. (Type: String, e.g., "/opt/ppl/etc/indicators_rgb7_control.json")

The snippet below demonstrates two different digital input/output devices, highlighting both the required and optional parameters.

```json
[
	{
	  "id": "pushbuttons",
	  "type": "digitalInputOutput",
	  "addressMap": "/opt/ppl/etc/pushbuttons_address_map.json",
	  "retainInputs": true,
	  "disabled": false
	},
	{
	  "id": "indicators",
	  "type": "digitalInputOutput",
	  "controlMap": "/opt/ppl/etc/indicators_rgb7_control.json",
	  "addressMap": "/opt/ppl/etc/indicators_address_map.json",
	  "disabled": false
	}
]
```

<aside>
⚠️ When configuring a digital input or output device, ensure that all required parameters are correctly specified to avoid configuration errors. Optional parameters can provide additional functionality and control but are not necessary for basic operation. Always verify that the paths provided for **addressMap** and **controlMap** are accurate and that the files exist in the specified locations.

</aside>

### Device Type: Analog Input/Output

To add an analog input or an analog output device, such as voltage transducer, the following parameters are required.

**Required Parameters:**

- **id:** A unique identifier for the device. (Type: String, e.g., “transducer”)
- **type:** Indicates the type of device. For this type of device, it is always "analogInputOutput". (Type: String, e.g., "analogInputOutput")
- **addressMap:** The path to the device’s address map on the controller. This should always be in the “opt/ppl/etc” directory. (Type: String, e.g., "/opt/ppl/etc/vmt_address_map.json")
- **disabled:** Indicates whether the device is enabled or disabled. A value of true means the device is disabled, while false means the device is enabled. (Type: Bool)

The snippet below illustrates an analog input/output device, highlighting the required parameters. Note that no optional parameters should be added for this device type.

```json
{
  "id": "transducer",
  "type": "analogInputOutput",
  "addressMap": "/opt/ppl/etc/vmt_address_map.json",
  "disabled": false
}
```